import React, { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { authSchema } from "../lib/validation"
import { useDispatch } from "react-redux"
import { login } from "../store/slices/authSlice"
import { useNavigate, Link } from "react-router-dom"

export default function Login(){
  const dispatch = useDispatch()
  const navigate = useNavigate()
  const [show, setShow] = useState(false)
  const { register, handleSubmit, formState: { errors, isSubmitting } } =
    useForm({ resolver: zodResolver(authSchema) })

  const onSubmit = async data => {
    try {
      await dispatch(login(data)).unwrap()
      navigate("/")
    } catch(e){
      alert(e.message || "Login failed")
    }
  }

  return (
    <div className="min-h-[80vh] flex items-center justify-center px-4">
      <div className="w-full max-w-md">
        <div className="bg-gradient-to-br from-white/60 to-white/40 backdrop-blur-lg rounded-3xl p-6 shadow-xl border border-slate-100">
          <div className="flex items-center gap-3 mb-6">
            <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center text-white text-lg font-semibold">
              TM
            </div>
            <div>
              <h1 className="text-xl font-semibold">Welcome back</h1>
              <p className="text-sm text-slate-500">Sign in to manage your tasks</p>
            </div>
          </div>

          <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
            <label className="block">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm font-medium text-slate-700">Username</span>
              </div>
              <div className="relative">
                <input
                  {...register("username")}
                  placeholder="your.username"
                  className="input pl-10"
                  autoComplete="username"
                />
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                  <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 11c1.657 0 3-1.343 3-3S17.657 5 16 5s-3 1.343-3 3 1.343 3 3 3zM6 21a6 6 0 0112 0" />
                  </svg>
                </div>
              </div>
              {errors.username && <p className="text-xs text-red-500 mt-2">{errors.username.message}</p>}
            </label>

            <label className="block">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm font-medium text-slate-700">Password</span>
                <Link to="/forgot" className="text-xs text-slate-500 hover:underline">Forgot?</Link>
              </div>
              <div className="relative">
                <input
                  type={show ? "text" : "password"}
                  {...register("password")}
                  placeholder="••••••••"
                  className="input pl-10 pr-10"
                  autoComplete="current-password"
                />
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                  <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 11c.828 0 1.5-.672 1.5-1.5S12.828 8 12 8s-1.5.672-1.5 1.5S11.172 11 12 11z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.478 0-8.268-2.943-9.542-7z" />
                  </svg>
                </div>
                <button type="button" onClick={() => setShow(s => !s)} className="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 p-2 rounded-md hover:bg-slate-100">
                  {show ? (
                    <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.956 9.956 0 012.223-3.64M3 3l18 18" />
                    </svg>
                  ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.478 0-8.268-2.943-9.542-7z" />
                    </svg>
                  )}
                </button>
              </div>
              {errors.password && <p className="text-xs text-red-500 mt-2">{errors.password.message}</p>}
            </label>

            <div className="flex items-center justify-between text-sm text-slate-600">
              <label className="flex items-center gap-2">
                <input type="checkbox" className="h-4 w-4 rounded border-slate-300" {...register("remember")} />
                <span>Remember me</span>
              </label>
              <div className="text-xs text-slate-400">Secure on this device</div>
            </div>

            <button type="submit" disabled={isSubmitting} className="w-full btn flex items-center justify-center gap-3">
              {isSubmitting ? (
                <>
                  <svg className="w-5 h-5 animate-spin" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" className="opacity-25"></circle>
                    <path d="M4 12a8 8 0 018-8" stroke="currentColor" strokeWidth="4" strokeLinecap="round" className="opacity-75"></path>
                  </svg>
                  Signing in...
                </>
              ) : (
                "Sign in"
              )}
            </button>
          </form>

          <div className="my-4 flex items-center gap-3">
            <div className="flex-1 h-px bg-slate-100"></div>
            <div className="text-xs text-slate-400">or continue with</div>
            <div className="flex-1 h-px bg-slate-100"></div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <button className="btn bg-slate-800 hover:bg-slate-900 flex items-center justify-center gap-2">
              <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.3c0-.7-.1-1.3-.2-1.9H12v3.6h4.9c-.2 1-.8 2-1.8 2.6v2.2h2.9c1.7-1.6 2.7-3.9 2.7-6.5z"/><path d="M12 22c2.5 0 4.6-.8 6.1-2.2l-2.9-2.2c-.8.6-2 .9-3.2.9-2.5 0-4.6-1.7-5.3-4.1H3.6v2.6C5 19.9 8.3 22 12 22z"/><path d="M6.7 13.4A5.99 5.99 0 016 12c0-.4.1-.8.1-1.2V8.2H3.6C3.2 9.3 3 10.6 3 12c0 1.4.2 2.7.6 3.8l3.1-2.4z"/><path d="M12 5.2c1.3 0 2.5.5 3.4 1.4l2.6-2.6C16.5 2.5 14.5 1.6 12 1.6 8.3 1.6 5 3.7 3.6 6.6l3.1 2.6C7.4 7 9.5 5.2 12 5.2z"/></svg>
              Google
            </button>
            <button className="btn bg-slate-100 text-slate-900 hover:bg-slate-200">
              <svg className="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12.1c0-.8 0-1.6-.1-2.4H12v4.6h5.7c-.2 1.5-.9 2.7-1.9 3.5v2.9h3.1c1.8-1.6 2.8-4.1 2.8-7.6z"/></svg>
              GitHub
            </button>
          </div>

          <div className="text-center text-xs text-slate-500 mt-4">
            Don't have an account? <Link to="/register" className="text-slate-700 font-medium hover:underline">Sign up</Link>
          </div>
        </div>
      </div>
    </div>
  )
}
